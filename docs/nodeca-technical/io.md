IO
==

## nodeca.io.on(event, handler)

Regster `handler` for given io `event`.

``` javascript
nodeca.io.on('api3:version-mismatch', function (versions) {
  alert('Versions mismatch. Server is' + versions.server +
        ' and client is ' + versions.client);
});
```


## nodeca.io.off(event[, handler])

Unregister `handler` (or all handlers if it wasn't given) for an `event`.


## nodeca.io.init()

Initiates underlying connections and all necessary authentications.


## nodeca.io.auth()

Authenticates reatime client on server and sets received session id.


## nodeca.io.subscribe(channel, handler)

Register `handler` for messages on given `channel`.

``` javascript
nodeca.io.subscribe('/stats/users_online', function handler(message) { /* ... */  })
  .done(function () { /* ... subscribed ... */ })
  .fail(function () { /* ... subscription failed ... */ });
});
```


## nodeca.io.unsubscribe(channel[, handler])

Removes `handler` (or all handlers) from given `channel`.

``` javascript
nodeca.io.unsubscribe('/stats/users_online', handler)
  .done(function () { /* ... unsubscribed ... */ })
  .fail(function () { /* ... unsubscription failed ... */ });
});
```


## nodeca.io.publish(channel, message)

Sends `message` to the `channel`.

``` javascript
nodeca.io.publish('/chat/rooms/debian', message)
  .done(function () { /* ... published ... */ })
  .fail(function () { /* ... publishing failed ... */ });
});
```

## nodeca.io.apiTree(data[, options][, callback])

``` javascript
nodeca.io.apiTree(params, {timeout: 15}, function (err, res) {
  // handle err/response
});
```

### API tree underlying channels

We provide two private channels for request/response in format:

- `/x/<secret>/api3-req` - channel for requests
- `/x/<secret>/api3-res` - channel for responses

Privacy is guaranteed by using a random 128 bit crypto-strong string.
Clients are allowed to supscribe to _response_ and publish to _request_
channels only.


#### Communication protocol

Client sends a message to the _requests_ channel with following structure:

    id:           <Number>    Request ID. Generated by client.
    msg:
      version:    <String>    Application version.
      method:     <String>    Server method name. E.g. 'nodeca.server.foobar'
      params:     <Mixed>     Parameters object given to `nodeca.server.*` method.

Once server executed request it will publish a message to the _responses_
channel with following structure:

    id:           <Number>    Original request ID.
    msg:
      version:    <String>    Application version.
      error:      <String>    An error if any.
      result:     <Mixed>     Server response.
